var toristySearch,toristyData;jQuery(function(b){var a={item:b(".toristy-search-item"),btn:b(".toristy-btn-search"),search:{},datas:[],wait:false,start:function(){this.item.autoComplete({minChars:3,source:this.find,onSelect:this.select,delay:150});this.btn.on("click",this.choose);b(".toristy-search-form").on("submit",this.choose)},cache:function(d){var e,c=d.length,f;for(e=0;e<c;e++){f=d[e];if(!a.datas.hasOwnProperty(f.label)){a.datas.push(f)}}},pick:function(h,f){var e,d=h.length,g,c=[];for(e=0;e<d;e++){g=h[e];if(g.label.toLowerCase().indexOf(f)!==-1&&c.indexOf(g.label)===-1){c.push(g.label)}}return c},find:function(f,g){if(!a.wait){var e=f.toLowerCase(),d="Search for: "+f,c=[d].concat(a.pick(a.datas,e));a.search={label:d,value:e};if(c.length<=1){a.ajax(e,g,d)}else{g(c)}}},ajax:function(d,e,c){b.ajax({url:toristySearch.url,type:"post",data:{action:"toristy_search",nonce:toristySearch.nonce,search:d},success:function(g){var f=[c];if(g&&g.success&&g.data){if(g.data.length>0){a.cache(g.data);f=f.concat(a.pick(g.data,d))}}e(f);a.wait=false}})},select:function(d,c){a.to(c)},choose:function(d){d.preventDefault();var c=a.item;a.to(c.val())},to:function(g){var f=this.search,k;if(f&&f.label&&f.label===g){this.item.val(f.value);g=f.value}else{k=this.match(g)}if(!k){var j=window.location.href.toLowerCase(),e=["/filter/","/search/","/provider/"],d,c=e.length;for(d=0;d<c;d++){if(j.indexOf(e[d])!==-1){j=j.split(e[d])[0];break}}var h=j.substr(-1);g=g.replace(/\s+/g,"-").toLowerCase();k=(h==="/")?j+"search/"+g:j+"/search/"+g}if(k){this.item.val("").blur();window.location.href=k}return false},match:function(e){var d,g=this.datas,c=g.length,f;for(d=0;d<c;d++){f=g[d];if(f.label===e){return f.value}}return undefined},sync:function(){b.ajax({url:toristyData.url,type:"post",data:{action:"toristy_task",nonce:toristyData.nonce},success:function(c){console.log(c)}})}};a.start()});